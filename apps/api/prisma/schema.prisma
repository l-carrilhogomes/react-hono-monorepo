// =============================================================================
// PRISMA SCHEMA - BETTER AUTH
// =============================================================================
// This schema contains the models required for Better Auth authentication.
// Generated automatically by @better-auth/cli generate
// 
// Better Auth Models:
// - User         : Application users
// - Session      : Active authentication sessions
// - Account      : Linked accounts (OAuth, email/password)
// - Verification : Email verification tokens
// =============================================================================

generator client {
  provider   = "prisma-client"
  output     = "../src/generated/prisma"
  engineType = "client"
  runtime    = "bun"
}

datasource db {
  provider = "postgresql"
}

// =============================================================================
// APPLICATION MODELS
// =============================================================================

/// User comments - existing application model
model Comment {
  id      Int    @id @default(autoincrement())
  comment String
}

// =============================================================================
// BETTER AUTH MODELS
// =============================================================================

/// Application user.
/// Contains basic user information.
/// The sessions and accounts relations enable multi-device
/// and multi-provider authentication management.
model User {
  id            String    @id /// Unique identifier (UUID generated by Better Auth)
  name          String /// User display name
  email         String /// Email address (unique)
  emailVerified Boolean   @default(false) /// Is email verified?
  image         String? /// Avatar URL (optional)
  createdAt     DateTime  @default(now()) /// Creation timestamp
  updatedAt     DateTime  @updatedAt /// Last update timestamp
  sessions      Session[] /// User's active sessions
  accounts      Account[] /// Linked accounts (OAuth, credentials)

  @@unique([email])
  @@map("user")
}

/// Authentication session.
/// Each login creates a new session with a unique token.
/// Enables multi-device connection management.
model Session {
  id        String   @id /// Unique session identifier
  expiresAt DateTime /// Session expiration date
  token     String /// Session token (sent in cookies)
  createdAt DateTime @default(now()) /// Creation timestamp
  updatedAt DateTime @updatedAt /// Last update timestamp
  ipAddress String? /// Client IP address (optional)
  userAgent String? /// Browser user-agent (optional)
  userId    String /// Reference to user
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([token])
  @@index([userId])
  @@map("session")
}

/// Authentication account.
/// Links a user to an authentication method (email/password, OAuth).
/// A user can have multiple accounts (e.g., Google + GitHub).
model Account {
  id                    String    @id /// Unique account identifier
  accountId             String /// Account ID at the provider
  providerId            String /// Provider identifier (credentials, google, github...)
  userId                String /// Reference to user
  user                  User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  accessToken           String? /// OAuth access token (optional)
  refreshToken          String? /// OAuth refresh token (optional)
  idToken               String? /// OAuth ID token (optional)
  accessTokenExpiresAt  DateTime? /// Access token expiration
  refreshTokenExpiresAt DateTime? /// Refresh token expiration
  scope                 String? /// OAuth scopes requested
  password              String? /// Hashed password (for credentials)
  createdAt             DateTime  @default(now()) /// Creation timestamp
  updatedAt             DateTime  @updatedAt /// Last update timestamp

  @@index([userId])
  @@map("account")
}

/// Verification token.
/// Used for email verification and password reset.
model Verification {
  id         String   @id /// Unique identifier
  identifier String /// Identifier (email, etc.)
  value      String /// Token value
  expiresAt  DateTime /// Expiration date
  createdAt  DateTime @default(now()) /// Creation timestamp
  updatedAt  DateTime @updatedAt /// Last update timestamp

  @@index([identifier])
  @@map("verification")
}
